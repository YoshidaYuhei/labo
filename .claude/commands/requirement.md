# 要件ブラッシュアップコマンド

このコマンドは、ユーザーのざっくりした要望を対話的にブラッシュアップし、GitHub Issue のテンプレート（feature_request.md）形式で出力します。

## 使い方
```
/requirement <ざっくりした要望>
```

または

```
/requirement
```
（引数なしで実行すると、要望を入力するよう促されます）

## 処理フロー

1. **初期要望の取得**: ユーザーからざっくりした要望を受け取る
2. **要望の分析**: 要望を分析し、不足している情報を特定
3. **対話的な質問**: 不足情報を埋めるために質問を重ねる
4. **要件の整理**: 収集した情報を整理
5. **テンプレート出力**: feature_request.md 形式で出力

## 実行手順

### ステップ1: 初期要望の取得

引数が指定されている場合はそれを使用し、指定されていない場合はユーザーに要望の入力を促してください。

**質問例:**
```
実現したい機能やユースケースをざっくりと教えてください。
例: 「ユーザーが自分の投稿履歴を一覧で見られるようにしたい」
```

### ステップ2: 要望の分析

初期要望を分析し、feature_request.md テンプレートの各セクションに必要な情報を整理します。

**分析の観点:**
- この機能の目的は何か（概要）
- なぜ必要か（背景・動機）
- 現在の状態はどうか（Before）
- 実装後はどうなるか（After）
- UIはどう変わるか
- 技術的にどう実装するか（実装方針）
- APIやSchemaの変更は必要か

### ステップ3: 対話的な質問

不足している情報を埋めるために、以下の順序で質問を行ってください。
**一度に全ての質問をせず、ユーザーの回答を見ながら段階的に質問してください。**

#### 3-1. 概要と背景の確認

まず、機能の全体像と必要性を明確にします。

**質問項目:**
- この機能で何を実現したいですか？（概要）
- なぜこの機能が必要ですか？どんな課題を解決しますか？（背景・動機）
- 誰が使う機能ですか？（対象ユーザー）

#### 3-2. 外形的振る舞いの確認

ユーザー体験に焦点を当てて詳細を聞きます。

**質問項目:**
- **現在の状態（Before）:**
  - 現在、ユーザーはどのように操作していますか？
  - どんな不便さがありますか？

- **変更後の状態（After）:**
  - 機能実装後、ユーザーはどのように操作しますか？
  - 具体的な操作フローを教えてください（ステップバイステップで）

- **UI/UXの変更:**
  - 画面に何が追加されますか？（ボタン、フォーム、リストなど）
  - 既存の画面に変更はありますか？
  - どのページに実装しますか？（Frontend: type_labo/ または Backend: APIのみ）

- **デザイン:**
  - デザインやモックアップはありますか？（Figmaリンクやスケッチなど）

#### 3-3. 技術的詳細の確認

実装に必要な技術的情報を収集します。

**質問項目:**
- **実装方針:**
  - どのように実装しますか？（技術的なアプローチ）
  - 既存のコードで参考になる部分はありますか？
  - 新しいライブラリやツールの導入は必要ですか？

- **API の変更:**
  - 新しいAPIエンドポイントが必要ですか？
  - 既存のAPIを変更する必要がありますか？
  - どんなエンドポイントですか？（例: GET /api/v1/users/:id/posts）
  - リクエスト/レスポンスの形式は？

- **Schemaの変更:**
  - 新しいテーブルが必要ですか？
  - 既存テーブルにカラムを追加する必要がありますか？
  - どんなカラムが必要ですか？（名前、型、制約）

#### 3-4. 完了条件の確認

何をもって完了とするか明確にします。

**質問項目:**
- どうなれば完成とみなしますか？
- テストで確認すべきことは何ですか？
- ドキュメントの更新は必要ですか？

**デフォルトの完了条件（必ず含める）:**
- [ ] 外形的振る舞いが仕様通り
- [ ] APIが仕様通り動作
- [ ] テストが書かれている
- [ ] ドキュメントが更新されている

### ステップ4: 情報の整理と確認

収集した情報を整理し、ユーザーに確認します。

**確認方法:**
1. 収集した情報を簡潔にまとめて表示
2. 「この理解で合っていますか？修正や追加はありますか？」と確認
3. 修正があれば反映し、なければ次のステップへ

### ステップ5: テンプレート形式で出力

以下の形式で、コピー可能な形式で出力してください。

````markdown
## 概要

<!-- 何を実現したいか -->

[ステップ3-1で収集した「何を実現したいか」を記載]


## 背景・動機

<!-- なぜこの機能が必要か -->

[ステップ3-1で収集した「なぜ必要か」を記載]


---

## 外形的振る舞い

### Before（変更前）

<!-- 現在のユーザー体験・操作フロー -->

[ステップ3-2で収集した現在の状態を記載]


### After（変更後）

<!-- 変更後のユーザー体験・操作フロー -->

[ステップ3-2で収集した変更後の状態を記載]


### UI/UX の変更

<!-- 画面の変化、追加・削除される要素 -->

[ステップ3-2で収集したUI/UXの変更を記載]


### デザイン・モックアップ

<!-- 画像やFigmaリンクがあれば -->

[ステップ3-2で収集したデザイン情報を記載]


---

## 完了条件

- [ ] 外形的振る舞いが仕様通り
- [ ] APIが仕様通り動作
- [ ] テストが書かれている
- [ ] ドキュメントが更新されている
[ステップ3-4で収集した追加の完了条件があれば記載]

---

## 実装方針

<!-- 技術的なアプローチ -->

[ステップ3-3で収集した実装方針を記載]


---

## API の変更

<!-- 該当するものを選択: 変更なし / 新規エンドポイント追加 / 既存エンドポイント更新 / 両方 -->
**変更タイプ:** [変更なし / 新規エンドポイント追加 / 既存エンドポイント更新 / 両方]

### API 詳細

[ステップ3-3で収集したAPI詳細を記載]
[APIの変更がない場合は「変更なし」と記載]

## Schemaの変更

[ステップ3-3で収集したSchema変更を記載]
[Schemaの変更がない場合は「変更なし」と記載]

````

出力の際は以下のように表示してください：

```
---

要件のブラッシュアップが完了しました！
以下の内容を GitHub Issue として作成できます。

<テンプレート内容をここに表示>

---

💡 **次のステップ:**
- このテンプレートをコピーして GitHub Issue に貼り付けてください
- または `gh issue create` コマンドで直接 Issue を作成できます

<gh コマンドの例を表示>
```

## 質問のベストプラクティス

### 段階的に質問する
- 一度に全ての質問をせず、3-4個ずつ区切って質問する
- ユーザーの回答を見て、次の質問を調整する
- 既に回答済みの情報は再度聞かない

### 具体例を示す
- 質問には具体例を含める
- プロジェクトの既存機能を参考例として示す

### 柔軟に対応する
- 「わからない」「後で決める」という回答も受け入れる
- その場合は「TODO: 後で決定」などと記載する
- 全ての項目が必須ではないことを理解する

### 技術的な推測を活用する
- プロジェクトの構造から推測できる情報は提案する
- 例: 「このプロジェクトはRails APIなので、`/api/v1/` 配下のエンドポイントになると思いますが、いかがですか？」

## 注意事項

- ユーザーが途中で「やめる」「キャンセル」と言った場合は、そこまでの内容を保存せずに終了
- 要望が曖昧すぎる場合は、具体例を求める
- 技術的に実現不可能な要望の場合は、代替案を提案する
- セキュリティやパフォーマンスの懸念がある場合は指摘する
- プロジェクトの既存パターンに従うよう提案する（CLAUDE.mdの規約を参照）

## 補足: プロジェクト固有の考慮事項

このプロジェクトの特性を踏まえた質問を行ってください：

### Backend (Rails API)
- APIエンドポイントは `/api/v1/` 配下か
- Ridgepole (db/Schemafile) での Schema 変更か
- OpenAPI ドキュメント (`public/doc/swagger.yml`) の更新が必要か
- committee-rails でのスキーマ検証が必要か
- Devise/JWT 認証が関わるか

### Frontend (Next.js)
- `type_labo/` ディレクトリ内の実装か
- React Native Web のコンポーネントを使うか
- APIとの連携方法（fetch, axios, など）

### テスト
- RSpec + FactoryBot でのテストか
- どんなテストケースが必要か
