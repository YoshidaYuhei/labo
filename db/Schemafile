# encoding: UTF-8
# frozen_string_literal: true

create_table :accounts,
             charset: 'utf8mb4',
             collation: 'utf8mb4_bin',
             force: :cascade,
             comment: 'アカウント' do |t|
  t.string   :email,              null: false, limit: 191, default: ""
  t.string   :encrypted_password, null: false, default: ""
  t.string   :reset_password_token, limit: 191
  t.datetime :reset_password_sent_at
  t.datetime :remember_created_at
  t.integer  :sign_in_count, default: 0, null: false
  t.datetime :current_sign_in_at
  t.datetime :last_sign_in_at
  t.string   :current_sign_in_ip
  t.string   :last_sign_in_ip
  t.string   :confirmation_token,   limit: 191
  t.datetime :confirmed_at
  t.datetime :confirmation_sent_at
  t.string   :unconfirmed_email,    limit: 191
  t.integer  :failed_attempts, default: 0, null: false
  t.string   :unlock_token,     limit: 191
  t.datetime :locked_at
  t.timestamps null: false

  t.index :email,                unique: true, length: { email: 191 }
  t.index :reset_password_token, unique: true, length: { reset_password_token: 191 }
  t.index :confirmation_token,   unique: true, length: { confirmation_token: 191 }
  t.index :unlock_token,         unique: true, length: { unlock_token: 191 }
end

create_table :jwt_denylists,
             charset: 'utf8mb4',
             collation: 'utf8mb4_bin',
             primary_key: :id,
             force: :cascade, comment: 'JWT無効化リスト' do |t|
  t.string   :jti, null: false, comment: 'JWT ID'
  t.datetime :exp, null: false, comment: '有効期限'
  t.index :jti, name: 'index_jwt_denylists_on_jti'
end